<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SGA - Syst√®me de Gestion des Agents</title>
    
    <!-- Police Roboto -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome pour les ic√¥nes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Feuille de style unique -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üë§</text></svg>">
    
    <!-- Manifest pour application PWA (optionnel) -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50">
    
    <!-- Apple touch icon -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üë§</text></svg>">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <style>
        /* Styles inline minimaux pour le chargement initial */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #2c3e50;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: #3498db;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: white;
            font-size: 1.2em;
            margin-top: 10px;
        }
        
        /* Mode hors ligne */
        #offline-notification {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: #e74c3c;
            color: white;
            padding: 10px;
            text-align: center;
            z-index: 10000;
            font-weight: bold;
        }
        
        #offline-notification.show {
            display: block;
        }
        
        /* Version imprimable */
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
            
            #app-container {
                box-shadow: none !important;
                max-width: 100% !important;
            }
            
            .app-header {
                background: white !important;
                color: black !important;
                border-bottom: 2px solid black;
            }
            
            .planning-table th {
                background: #f0f0f0 !important;
                color: black !important;
                border: 1px solid black !important;
            }
            
            .planning-table td {
                border: 1px solid #ccc !important;
            }
            
            .shift-1 { background: #d4e6ff !important; color: black !important; }
            .shift-2 { background: #ffe0e0 !important; color: black !important; }
            .shift-3 { background: #e8d4ff !important; color: black !important; }
            .shift-R { background: #d4ffd4 !important; color: black !important; }
            .shift-C { background: #fff0d4 !important; color: black !important; }
            .shift-M { background: #ffedd4 !important; color: black !important; }
            .shift-A { background: #f0f0f0 !important; color: black !important; }
        }
    </style>
</head>
<body>
    <!-- √âcran de chargement initial -->
    <div id="loading-screen">
        <div class="spinner"></div>
        <div class="loading-text">Initialisation du SGA...</div>
    </div>
    
    <!-- Notification hors ligne -->
    <div id="offline-notification" class="no-print">
        <i class="fas fa-wifi-slash"></i> Mode hors ligne - Donn√©es locales uniquement
    </div>
    
    <!-- Conteneur principal -->
    <div id="app-container">
        <!-- En-t√™te -->
        <header class="app-header no-print">
            <h1 id="app-title">SGA - Syst√®me de Gestion des Agents</h1>
            <p id="sub-title">MENU PRINCIPAL</p>
            <div id="user-display" style="margin-top: 8px; font-size: 0.9em; color: #bdc3c7;">
                <i class="fas fa-user-circle"></i> <span id="current-user">Administrateur</span>
                <span id="user-role" class="role-badge role-admin" style="margin-left: 5px; font-size: 0.8em;">admin</span>
            </div>
        </header>
        
        <!-- Contenu principal -->
        <main id="main-content">
            <!-- Le contenu sera inject√© dynamiquement -->
            <div style="text-align: center; padding: 40px 20px; color: #95a5a6;">
                <i class="fas fa-cog fa-spin fa-2x" style="margin-bottom: 20px;"></i>
                <p>Chargement du syst√®me de gestion...</p>
            </div>
        </main>
        
        <!-- Pied de page -->
        <footer class="no-print" style="background: #34495e; padding: 10px; text-align: center; font-size: 0.8em; color: #95a5a6; border-top: 1px solid rgba(255,255,255,0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0 10px; flex-wrap: wrap;">
                <span>SGA v1.0 Compl√®te</span>
                <span id="data-status" style="font-size: 0.8em;">
                    <i class="fas fa-database"></i> <span id="data-count">0</span> agents
                </span>
                <span id="last-save" style="font-size: 0.8em;">
                    <i class="far fa-clock"></i> <span id="save-time">Jamais</span>
                </span>
            </div>
            <div style="margin-top: 5px; font-size: 0.75em; opacity: 0.7;">
                ¬© 2024 - Tous droits r√©serv√©s
            </div>
        </footer>
    </div>
    
    <!-- Overlay pour popups -->
    <div id="popup-overlay" class="overlay no-print">
        <div id="popup-content" class="popup-content">
            <div class="popup-header">
                <h2 id="popup-title">Titre</h2>
                <button id="popup-close-btn" class="popup-close-btn">&times;</button>
            </div>
            <div id="popup-body" class="popup-body">
                <!-- Contenu dynamique -->
            </div>
            <div id="popup-footer" class="popup-footer">
                <!-- Boutons dynamiques -->
            </div>
        </div>
    </div>
    
    <!-- Snackbar pour notifications -->
    <div id="snackbar"></div>
    
    <!-- Script JavaScript principal -->
    <script>
        // Cacher l'√©cran de chargement
        window.addEventListener('load', function() {
            setTimeout(function() {
                const loadingScreen = document.getElementById('loading-screen');
                loadingScreen.style.opacity = '0';
                setTimeout(function() {
                    loadingScreen.style.display = 'none';
                }, 500);
            }, 800);
        });
        
        // Gestion du mode hors ligne
        window.addEventListener('online', function() {
            document.getElementById('offline-notification').classList.remove('show');
        });
        
        window.addEventListener('offline', function() {
            document.getElementById('offline-notification').classList.add('show');
        });
        
        // V√©rifier la connexion au chargement
        if (!navigator.onLine) {
            document.getElementById('offline-notification').classList.add('show');
        }
        
        // Mettre √† jour le compteur de donn√©es
        function updateDataCount() {
            try {
                const agents = JSON.parse(localStorage.getItem('sga_agents') || '[]');
                const count = agents.length;
                document.getElementById('data-count').textContent = count;
                
                // Mettre √† jour la derni√®re sauvegarde
                const lastSave = localStorage.getItem('sga_lastBackup');
                if (lastSave) {
                    document.getElementById('save-time').textContent = lastSave;
                }
            } catch (e) {
                console.log("Donn√©es non encore initialis√©es");
            }
        }
        
        // Surveiller les sauvegardes
        setInterval(updateDataCount, 30000); // Toutes les 30 secondes
        
        // Initialiser au chargement
        document.addEventListener('DOMContentLoaded', updateDataCount);
        
        // Service Worker pour PWA (optionnel)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js').catch(err => {
                    console.log('ServiceWorker non enregistr√©:', err);
                });
            });
        }
        
        // Pr√©venir la fermeture accidentelle
        window.addEventListener('beforeunload', function (e) {
            // Ne pas afficher l'alerte en production pour une meilleure UX
            // e.preventDefault();
            // e.returnValue = '';
        });
    </script>
    
    <!-- Script de l'application -->
    <script src="app.js"></script>
    
    <!-- Script pour l'export PDF (optionnel - n√©cessite jsPDF) -->
    <!--
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    -->
</body>
</html>
